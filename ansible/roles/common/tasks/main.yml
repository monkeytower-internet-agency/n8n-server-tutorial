---
- name: Update apt cache
  apt:
    update_cache: yes
    cache_valid_time: 3600

- name: Install essential packages
  apt:
    name:
      - vim
      - git
      - curl
      - unzip
      - htop
      - tree
      - neovim
    state: present

- name: Install Starship
  shell: curl -sS https://starship.rs/install.sh | sh -s -- -y
  args:
    creates: /usr/local/bin/starship

- name: Install Nushell (via Cargo - Requires Rust)
  shell: |
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
    source $HOME/.cargo/env
    cargo install nu
  args:
    creates: /root/.cargo/bin/nu
    executable: /bin/bash
  # Note: This installs for root. Ideally we install for user 'ok' too.

- name: Configure Firewall (UFW)
  ufw:
    state: enabled
    policy: deny
    rule: allow
    name: OpenSSH

- name: Allow HTTP/HTTPS
  ufw:
    rule: allow
    port: "{{ item }}"
    proto: tcp
  loop:
    - 80
    - 443
